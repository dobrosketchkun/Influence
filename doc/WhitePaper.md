# Whitepaper
В этом документе описываются основные принципы работы мессенджера Influence.

# Основное

Сериализация данных (при передаче сообщений между участниками сети) происходит через MsgPack, бинарная реализация JSON (на этапе создания архитектуры будет временно использоваться обычный JSON).
Используется ассиметричное шифрование (OpenSSL lib). Передача сообщений происходит по протоколу UDP. В качестве интерфейса будет использоваться Qt Widgets.

# Архитектура мессенджера

Клиент мессенджера будет состоять из двух компонентов: ядро и GUI. Ядро отделено от GUI классами-обертками (делегатами). Такая архитектура позволяет писать клиенты мессенджера с любым графическим представлением.

# Идентификация пользователей

Пока пользователи будут идентифицироваться по IPv6 (публичный ключ) в сети Hyperboria. Если есть что предложить - обсуждайте в конференции разработки в Telegram: [@influence_dev](https://t.me/influence_dev).

# Offline-сообщения

Рассмотрим пример: есть Алиса, есть Боб. Алиса хочет отправить сообщения Бобу, но он в это время находится оффлайн. При этом Алиса тоже ушла в оффлайн. В этом случае, сообщение не дойдет до адресата, т.к. нету промежуточных серверов. Чтобы гарантировать доставку сообщения, необходимо ввести сервера-транзиты, которые будут предназначены для передачи оффлайн-сообщений. Эти сервера необязательны, но если клиенты хотят передавать оффлайн-сообщения - тот тут без транзит-серверов не обойтись. У каждого клиента сети будет список доверенных контактов, которые будут в качестве транзита для сообщений. При отправке человеку, который находится оффлайн, выбирается случайный контакт из списка доверенных, и это сообщение отправляется (с публичным ключом) ему. Далее, контакт-транзит (возможен и сервер) держит у себя это сообщение до тех пор, пока оно не отправится получателю. Если сообщение не отправлено уже какой-то отрезок времени (настраивается админом сервера-транзита), то сообщение удаляется.


# Вопрос аккаунта 

Одноранговость системы и отсутствие регистрации как таковой ставит вопрос сохранения за собой т.н. веб айдентити. При инициализации, cjdns сама генерирует псевдослучайную пару ключей для получения ipv6 ареса, т.е. при запуске на разных устройствах клиент будет иметь разные адреса для доставки отправленных сообщений, что приведёт к их неполучению. Нативный способ сохранения адреса представляет собой перенос cjdroute.conf, что не слишком юзер-френдли.

Для решения данной проблемы предлагается использовать детерминированную генерацию пары ключей _de novo_ на устройстве с использованием парольной фразы. Таким образом при установке Influence на устройстве человеку необходимо лишь ввести пароль, чтобы продолжить получать сообщения. Аналогичным способом можно переносить ростер (список контактов), периодически рассылая его как зашифрованное сообщение "себе" со специальной пометкой.

Очевидно данный способо несёт в себе некоторые риски в компьюторной безопасности из-за тенденции пользователей использовать простые пароли. Дабы обойти это в GUI компоненте системы необходимо использовать некоторые критерии приемлимости пароля, конкретика которых остаётся на совести создателей оболочки.

Также существует возможность объединить оба подхода, с выбором использовать ли пароль или сгенерировать файл, бэкап которого пользователь сам обязуется совершить.

# Другие пути реализации

Иной возможностью для реализации концепции однорангового, нецензируемого мессенджера является использование ipfs как сети передачи данных.
Хотя при помощи ранних имплементаций протокола ipfs было бы сложно реализовать какой бы то ни было нормальный функционал, на нынешней стадии это вполне возможно, при использовании ipns. 
Уже и сейчас существуют реализации мессенджеров, хоть и не шибко удобных и со слабой защитой https://github.com/orbitdb/orbit


Переход Influence на ipfs позволит "из коробки" иметь распределённую и нецензурируюмую сеть. Учитывая особенности протокола, можно реализовать удаление и редактирование сообщений (посредством смены содержания ipns), поддержку видео и изображений на стороне клиента, поддержание функционала "каналов" (на стороне клиента посредством специальных меток в сообщении), поддержку стикеров (можно поступить аналогично телеграму - стикером считается изображение специального размера формата webm)
Также особенности ipfs позволит довольно легко сделать клиент для десктопных ОСей, используя API ipfs.io и аналогов для получения сообщений.
Уход от способа генерации пары ключей в cjdns позволит использовать способ, более удобный для пользователя, чем просто бэкап файла с ключами. Например, можно напрямую взять способ, используемый в генерации ключей для биткоин адреса https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki 

